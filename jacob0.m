clear;
clc;
close all;
%定义变量
syms L1 L2 L3  L4 real
syms theta_1 theta_2 theta_3  theta_4 real

%相邻两个坐标系的变换矩阵
% T_0_1=[cos(theta_1) -sin(theta_1) 0 0;...
%        sin(theta_1) cos(theta_1) 0 0;...
%        0 0 1 L1;...
%        0 0 0 1];
% T_1_2=[cos(theta_2) -sin(theta_2) 0 0;...
%        0 0 -1 0;...
%        sin(theta_2) cos(theta_2) 0 0;...
%        0 0 0 1];
% T_2_3=[cos(theta_3) -sin(theta_3) 0 L2;...
%        sin(theta_3) cos(theta_3) 0 0;...
%        0 0 1 0;...
%        0 0 0 1];
% T_3_4=[1 0 0 L3;...
%        0 1 0 0;...
%        0 0 1 0;...
%        0 0 0 1];
T_0_1 = [cos(theta_1) -sin(theta_1) 0 0;...
         sin(theta_1) cos(theta_1) 0 0;...
         0 0 1 0;...
         0 0 0 1];
T_1_2 = [cos(theta_2) -sin(theta_2) 0 L1;...
         sin(theta_2) cos(theta_2) 0 0;...
         0 0 1 0;...
         0 0 0 1];
T_2_3 = [cos(theta_3) -sin(theta_3) 0 L2;...
         sin(theta_3) cos(theta_3) 0 0;...
         0 0 1 0;...
         0 0 0 1];
T_3_4 = [cos(theta_4) -sin(theta_4) 0 L3;...
         sin(theta_4) cos(theta_4) 0 0;...
         0 0 1 0;...
         0 0 0 1];        
T_4_5 = [1 0 0 L4;...
         0 1 0 0;...
         0 0 1 0;...
         0 0 0 1];    
    
%各参考系相对于坐标系0的变换矩阵
%T_0_1 = T_0_1;
T_0_2 = T_0_1*T_1_2;
T_0_3 = T_0_1*T_1_2*T_2_3;
T_0_4 = T_0_1*T_1_2*T_2_3*T_3_4;
T_0_5 = T_0_1*T_1_2*T_2_3*T_3_4*T_4_5;

%构造速度雅克比矩阵
% J = sym([]);
syms J 
Xp= T_0_5(1:3,4);
temp1 = [diff(Xp,theta_1)';diff(Xp,theta_2)';diff(Xp,theta_3)';diff(Xp,theta_4)'];
temp2 = [T_0_1(1:3,3)';T_0_2(1:3,3)';T_0_3(1:3,3)';T_0_4(1:3,3)'];
% for j=1:1:4
%    for i=1:1:4
%        J(i,j)= temp1(j,i);
%        J(i+3,j)= temp2(j,i);
%    end
% end
J(1:3,1) = diff(Xp,theta_1);
J(1:3,2) = diff(Xp,theta_2);
J(1:3,3) = diff(Xp,theta_3);
J(1:3,4) = diff(Xp,theta_4);
J(4:6,1) = T_0_1(1:3,3);
J(4:6,2) = T_0_2(1:3,3);
J(4:6,3) = T_0_3(1:3,3);
J(4:6,4) = T_0_4(1:3,3);

J

% L1 = 10;
% theta_1 = pi/6










